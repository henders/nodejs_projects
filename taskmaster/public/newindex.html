<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!-- Consider adding an manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <!-- Use the .htaccess and remove these lines to avoid edge case issues.
       More info: h5bp.com/b/378 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Task Master App</title>
  <meta name="description" content="">
  <meta name="author" content="Shane Hender">

  <!-- Mobile viewport optimized: j.mp/bplateviewport -->
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Place favicon.ico and apple-touch-icon.png in the root directory: mathiasbynens.be/notes/touch-icons -->

  <!-- CSS: implied media=all -->
	<!-- CSS concatenated and minified via ant build script-->
	<link rel='stylesheet' href="/css/humanity/jquery-ui-1.8.16.custom.css" /> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/latest/jquery.mobile.css" />
	<link rel='stylesheet' href="/css/basestyle.css" />
	<!-- end CSS-->

  <!-- More ideas for your <head> here: h5bp.com/d/head-Tips -->

  <!-- All JavaScript at the bottom, except for Modernizr / Respond.
       Modernizr enables HTML5 elements & feature detects; Respond is a polyfill for min/max-width CSS3 Media Queries
       For optimal performance, use a custom Modernizr build: www.modernizr.com/download/ -->
  <script src="js/libs/modernizr-2.0.6.min.js"></script>
</head>

<body> 
	<div id="container">
		<div data-role="page" id="loginPage">
			<div data-role="header" data-position="fixed" data-title="Login"><h3>Login</h3></div>
			<div data-role="content"></div>
			<div data-role="footer" data-id="footer" class="footer" data-position="fixed"></div>
		</div>

		<div data-role="page" id="addChorePage">
			<div data-role="header" data-position="fixed" data-title="Login"><h3>Add Chore</h3></div>
			<div data-role="content"></div>
			<div data-role="footer" data-id="footer" class="footer" data-position="fixed"></div>
		</div>

		<div data-role="page" id="choresPage">
			<div data-role="header" data-position="fixed" data-title="Login"><h3>Add Chore</h3></div>
			<div data-role="content"></div>
			<div data-role="footer" data-id="footer" class="footer" data-position="fixed"></div>
		</div>

		<div data-role="page" id="friendsPage">
			<div data-role="header" data-position="fixed" data-title="Login"><h3>Add Chore</h3></div>
			<div data-role="content"></div>
			<div data-role="footer" data-id="footer" class="footer" data-position="fixed"></div>
		</div>
	</div> <!--! end of #container -->


  <!-- JavaScript at the bottom for fast page loading -->

  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
 	<script type="text/javascript" src="/js/libs/jquery-1.6.4.min.js"></script>
	<script type="text/javascript" src="/js/libs/jquery.cookie-1.0.js"></script>
	<script type="text/javascript" src="/js/libs/underscore-min.js"></script>
	<script type="text/javascript" src="/js/libs/jquery-ui-1.8.16.custom.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/mobile/latest/jquery.mobile.js"></script>
	<script type="text/javascript" src="/js/libs/crypto-min.js"></script>
	<script type="text/javascript" src="/js/libs/crypto-sha256-hmac.js"></script>
	<script type="text/javascript" src="/js/libs/flot/jquery.flot.min.js"></script>
	<script type="text/javascript" src="/js/libs/flot/jquery.flot.pie.min.js"></script>
 	<script type="text/javascript" src="/js/utils.js"></script>
 	<script type="text/javascript" src="/js/login.js"></script>
 	<script type="text/javascript" src="/js/addchores.js"></script>

  <!-- scripts concatenated and minified via ant build script-->
  <script defer src="js/plugins.js"></script>
  <script defer src="js/script.js"></script>
  <!-- end scripts-->

	<script type="text/template" id="header_template">
		<footer>
			<nav>
				<div data-role="navbar">
					<ul>
						<li><a href="/newindex.html#addChorePage" id="home_icon">Add Chore</a></li>
						<li><a href="/newindex.html#choresPage" id="chores_icon">View Chores</a></li>
						<li><a href="/newindex.html#friendsPage" id="friends_icon">Friends</a></li>
						<li><a href="/newindex.html#loginPage" id="logout_icon">Logout</a></li>
					</ul>
				</div>
			</nav>
		</footer>
	</script>

	<script type="text/javascript" charset="utf-8">
		// our global object
		var taskmaster = JSON.parse($.cookie('taskmaster')) || {};

		function createSignature(path, paramObject) {
			var now = new Date();
			paramObject.timestamp = now.getTime();
			// Create query string from object
			var queryString = "?";
			var keys = _.keys(paramObject);
			console.log("keys = " + JSON.stringify(keys));
			keys.sort();
			_.each(keys, function(key) { queryString += key + "=" + paramObject[key] + "&"; });

			var sig = path + queryString;
			console.log('hashing sig: ' + sig);
			return Crypto.HMAC(Crypto.SHA256, sig, taskmaster.user.secretkey);
		}

		function showMsg(message) {
			//show error message
			$( "<div class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h1>"+ message +"</h1></div>" )
			.css({ "display": "block", "opacity": 0.96, "topq": $( window ).scrollTop() + 100 })
			.appendTo( $.mobile.pageContainer )
			.delay( 800 )
			.fadeOut( 1200, function() {
				$( this ).remove();
			});
		}

		function loadPage(url, $page, navButton, loadItNow) {
			$.get(url, function(data) {
				var $content = $page.children( ":jqmData(role=content)" );
				var $footer = $page.children( ":jqmData(role=footer)" );
				$content.html(data).trigger('create');
				$footer.html($('#header_template').html()).trigger('create');
				// initialize the jquery mobile page
				console.log('Load was performed: ' + url);
				if (loadItNow) {
					$('div.ui-page-active nav ' + navButton).addClass('ui-btn-active ui-state-persist');
					$.mobile.changePage( $page );
				}
				else {
//					$page.live( 'pageshow',function(event) {
//						console.log('Setting button states');
//						$('div.ui-page-active nav ' + navButton).addClass('ui-btn-active ui-state-persist');
//					});
				}
			});
		}

		$(document).bind("mobileinit", function () {i
			$.mobile.page.prototype.options.footerTheme = "b";
		});

		console.log('loading pages....');
		loadPage("/loginPage.html", $('#loginPage'), '#home_icon', true);
		loadPage("/addChorePage.html", $('#addChorePage'), '#home_icon', false);
//		loadPage("/choresPage.html", $('#choresPage'), '#chores_icon');
//		loadPage("/friendsPage.html", $('#friendsPage'), '#friends_icon');

		$(function() {
			var fixgeometry = function() {
				console.log("fixing geometry");
				/* Some orientation changes leave the scroll position at something
				* that isn't 0,0. This is annoying for user experience. */
				scroll(0, 0);

				/* Calculate the geometry that our content area should take */
				var header = $(".ui-header:visible");
				var footer = $(".ui-footer:visible");
				var content = $(".ui-content:visible");
				var viewport_height = $(window).height();

				var content_height = viewport_height - header.outerHeight() - footer.outerHeight();

				/* Trim margin/border/padding height */
				content_height -= (content.outerHeight() - content.height());
				content.height(content_height);
			}; /* fixgeometry */

			$(document).ready(function() {
//				$(window).bind("orientationchange resize pageshow", fixgeometry);
			});

		});

	</script>


  <!-- Change UA-XXXXX-X to be your site's ID -->
  <script>
    window._gaq = [['_setAccount','UA-26875404-1'],['_trackPageview'],['_trackPageLoadTime']];
    Modernizr.load({
      load: ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js'
    });
  </script>


  <!-- Prompt IE 6 users to install Chrome Frame. Remove this if you want to support IE 6.
       chromium.org/developers/how-tos/chrome-frame-getting-started -->
  <!--[if lt IE 7 ]>
    <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
    <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->
  
</body>
</html>

